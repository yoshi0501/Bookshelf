# エンタープライズ企業導入にあたり問題になりそうな実装要件・リスク一覧

エンタープライズ企業への導入を想定し、**現状の実装では不足している・検討が必要になりそうな要件**を一覧化したものです。  
既存ドキュメント（プラRE要件適合ギャップ一覧、サービス制限・契約事項、通信暗号化・アクセス制御）と重複する部分は「※既存ドキュメント参照」とし、**追加で問題になりそうな点**を中心に記載しています。

---

## 1. 認証・アクセス制御

| 要件・リスク | 現状 | エンタープライズで問題になりうる点 |
|--------------|------|-----------------------------------|
| **二要素認証（2FA/MFA）** | 未導入（パスワードのみ） | 大企業・金融系では 2FA 必須とされることが多い。`devise-two-factor` は Gemfile にコメントで存在。 |
| **SSO / SAML / LDAP** | 未実装 | 社内 ID 連携（Azure AD / Okta / 社内 LDAP）を求める企業が多い。Devise のみでは対応不可。 |
| **セッションタイムアウト** | 30 分（Devise 設定） | 企業ポリシーで「15 分」「8 時間」など要件が異なる。設定変更で対応可能。 |
| **同時ログイン制限** | なし | 同一アカウントの複数端末・複数ブラウザを制限していない。 |
| **IP アドレス制限・VPN 必須** | なし | 本番アクセスを特定 IP や VPN 内に限定する機能はアプリにない（リバースプロキシ・FW で対応する想定）。 |
| **ロールの細分化** | 内部管理者 / 会社管理者 / 一般 / メーカー の 4 種 | 「閲覧のみ」「発注のみ」「承認のみ」など、より細かい権限を求める場合に拡張が必要。 |

**参照**: 認証・パスワード・2FA の詳細は `docs/通信暗号化・アクセス制御_現状回答.md`、`docs/パスワード要件_現状回答.md` を参照。

---

## 2. 権限・ガバナンス（マルチテナントの深化）

| 要件・リスク | 現状 | エンタープライズで問題になりうる点 |
|--------------|------|-----------------------------------|
| **拠点（センター）ごとの権限** | 未実装 | 同一会社内で「拠点 A のみ閲覧」「拠点 B は発注のみ」など、拠点単位の権限が切れない。※ギャップ一覧 1 に記載済み。 |
| **承認の委任・代行** | 受注センターに承認者を紐づける方式（1センター1承認者） | 休暇・異動時に複数承認者や「代行」の概念がない。 |
| **監査ログの閲覧権限** | PaperTrail で履歴は保存 | 誰が・どの範囲の監査ログを閲覧できるかの画面・権限が未整備。 |
| **会社横断の管理者** | 内部管理者のみ全社閲覧 | 「複数社をまとめて見るが編集はできない」など、中間ロールがない。 |

---

## 3. 監査・コンプライアンス

| 要件・リスク | 現状 | エンタープライズで問題になりうる点 |
|--------------|------|-----------------------------------|
| **監査ログの保持期間** | 未定義 | 履歴テーブル（versions）の削除・アーカイブポリシーがなく、容量・法令対応が不明。 |
| **改ざん検知・イミュータブルログ** | 通常の DB 更新 | ログの改ざん防止（追記専用・ハッシュ連鎖等）は未実装。 |
| **PDF・帳票への証跡 ID** | 請求書に参照 ID 等なし | ※ギャップ一覧 8 に「PDF への参照 ID/証跡 ID の記載が未実装」とあり。 |
| **データエクスポート（契約終了時・依頼時）** | 契約終了時の移行支援は未規定 | ※サービス制限ドキュメント 9 に記載。CSV 等はあるが、契約終了に特化した形式・手順の保証はなし。 |
| **個人情報のマスキング・削除** | 未実装 | ユーザー名・メール・電話番号のログや画面でのマスキング、削除フローがない。 |

---

## 4. 運用・SLA・障害対応

| 要件・リスク | 現状 | エンタープライズで問題になりうる点 |
|--------------|------|-----------------------------------|
| **計画メンテナンスの告知** | アプリ内に告知機能なし | ※サービス制限 4 参照。停止日時・影響範囲の事前表示ができない。 |
| **障害・障害復旧の記録** | アプリ外の運用に依存 | 障害履歴・RPO/RTO の管理はアプリでは行っていない。 |
| **バックアップ・リストア** | DB/ストレージはインフラ依存 | アプリから「バックアップ取得」「リストア手順」のトリガーや確認はなし。 |
| **ヘルスチェック・死活監視** | `GET /up` あり | 詳細な依存（DB・Redis・外部 API）の個別チェックやメトリクスは未実装。 |
| **レート制限・DDoS 対策** | アプリ層でのレート制限なし | ログイン試行・API 呼び出しのスロットリングは未実装（FW・CDN で対応する想定）。 |

---

## 5. データ・他システム連携

| 要件・リスク | 現状 | エンタープライズで問題になりうる点 |
|--------------|------|-----------------------------------|
| **REST API / 外部連携** | 未提供 | ※PROJECT_REVIEW に「JSON API 対応は将来的に」とある。ERP・会計・在庫システムとの連携を求められると対応不可。 |
| **バッチ・定時処理の仕様** | 明文化されていない | 夜間バッチ・日次集計・メール送信の時刻・再実行ポリシーがアプリ仕様としてない。 |
| **EDI・固定長・XML** | CSV のインポート/エクスポートあり | 業界標準の EDI や特定 XML スキーマには未対応。 |
| **データ連携の監査** | IntegrationLog はあるが用途は限定的 | 外部システムとの送受信ログ・エラー件数・再送フローが十分でない場合がある。 |

---

## 6. 契約・法務・表示

| 要件・リスク | 現状 | エンタープライズで問題になりうる点 |
|--------------|------|-----------------------------------|
| **利用規約・同意フロー** | アプリ内に規約表示・同意記録なし | 初回ログイン時の規約同意・同意日時の保存が未実装。※サービス制限 2・6 参照。 |
| **プライバシーポリシー・Cookie 同意** | 未実装 | 個人情報の取り扱い・Cookie 使用の明示と同意がアプリで行われていない。 |
| **SLA・稼働率の表示** | なし | 目標稼働率・計測方法・免責の記載がアプリ内にない。※サービス制限 4 参照。 |
| **第三者委託・サブコン開示** | アプリでは未管理 | ※サービス制限 7 参照。委託先一覧・再委託の開示を求められると別途整備が必要。 |

---

## 7. パフォーマンス・スケール

| 要件・リスク | 現状 | エンタープライズで問題になりうる点 |
|--------------|------|-----------------------------------|
| **ユーザー数・テナント数上限** | アプリで上限未設定 | ※サービス制限 1 参照。ライセンス契約と連動した「○社まで」「○ユーザーまで」の制限は未実装。 |
| **一覧・レポートの件数上限** | Pagy でページネーション | 10 万件超などの大量データでの検索・エクスポート時のタイムアウト・メモリ対策は要検証。 |
| **同時接続数・スロットリング** | 未制限 | 同時ログイン数やリクエスト数に応じた制御はアプリ層にない。 |

---

## 8. 既存ギャップ一覧・他ドキュメントとの対応

- **業務ドメイン（循環・CO2・CN 表示など）**: `docs/プラRE要件適合ギャップ一覧.md` に一覧あり。エンタープライズ以前に、ドメイン要件の未達が多数ある。
- **契約・SLA・解約・移行支援**: `docs/サービス制限・契約事項_現状回答.md` に現状と推奨がまとまっている。
- **認証・暗号化・2FA**: `docs/通信暗号化・アクセス制御_現状回答.md` を参照。

---

## まとめ：エンタープライズ導入前に検討したい実装・要件

| 優先度 | カテゴリ | 例（検討項目） |
|--------|----------|----------------|
| 高 | 認証 | 2FA の導入、SSO/ID 連携の要否 |
| 高 | 契約・表示 | 利用規約の表示・同意フロー、プライバシーポリシー |
| 高 | 監査 | 監査ログ保持期間、PDF への証跡 ID、エクスポート手順の明文化 |
| 中 | 権限 | 拠点別権限、承認委任、監査ログ閲覧権限 |
| 中 | 運用 | メンテ告知、バックアップ/リストア方針、ヘルスチェック拡張 |
| 中 | 連携 | 外部 API の要否、バッチ仕様の明文化 |
| 低 | スケール | ユーザー数上限の要否、大量データ時の方針 |

上記は「実装で足りていない・仕様として決めていない」点の整理です。エンタープライズごとの契約・セキュリティポリシーに合わせて、どこまでアプリで実装し、どこを規約・運用で補うかを切り分けて検討することを推奨します。
