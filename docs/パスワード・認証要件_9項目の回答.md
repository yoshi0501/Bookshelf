# パスワード・認証に関する9要件 — 本システムの回答

エンタープライズ向けパスワード・認証要件（9項目）に対する、本システム（Bookshelf）の実装状況および回答です。

---

## 1. 8桁以上且つ英数字混在の組み合わせとする

| 項目 | 本システムの対応 |
|------|------------------|
| 桁数 | **8文字以上** 128文字以下（`config.password_length = 8..128`）で検証しています。 |
| 英数字混在 | **英数字混在**を必須としています。数字・小文字・大文字をそれぞれ1文字以上含むことを `config.password_complexity`（devise-security）で検証しています。 |

**回答**: パスワードは **8桁以上** かつ **英数字混在**（数字・英小文字・英大文字を各1文字以上含む）の組み合わせとするよう実装しています。

---

## 2. ユーザーIDと同一のパスワードは許可しない

| 項目 | 本システムの対応 |
|------|------------------|
| 同一チェック | ログインID（本システムでは**メールアドレス**）と同一のパスワードを禁止するバリデーション（`PasswordValidations#password_not_same_as_email`）を実装しています。 |

**回答**: ユーザーID（メールアドレス）と同一のパスワードは設定できません。設定しようとした場合はエラーで拒否します。

---

## 3. ユーザーのログイン時に、連続して一定回数以上パスワード入力に失敗した場合、当該アカウントを使用不可又は一定時間ログイン不可とする

| 項目 | 本システムの対応 |
|------|------------------|
| ロック方式 | Devise の **Lockable** を利用しています。 |
| 失敗回数 | 連続 **5回** パスワード入力に失敗した場合にロックします（`maximum_attempts = 5`）。 |
| 解除 | **1時間** 経過後に自動解除、または「パスワードを忘れた場合」からリセットメールで解除できます（`unlock_in = 1.hour`）。 |

**回答**: ログイン時に連続して **5回** パスワード入力に失敗した場合、当該アカウントを **1時間ログイン不可**としています。解除は1時間経過後の自動解除、またはパスワードリセット手続きにより行います。

---

## 4. パスワード入力時に他者から見えないようマスクした表示にする

| 項目 | 本システムの対応 |
|------|------------------|
| 表示 | ログイン・新規登録・パスワード変更・パスワードリセットのすべてのパスワード入力欄で、HTML の **`password` 型入力欄**（`password_field`）を使用しており、入力内容はマスク表示（●等）になります。 |

**回答**: パスワード入力時は、他者から見えないよう **マスク表示**としています。

---

## 5. 有効期限を3か月以内とする

| 項目 | 本システムの対応 |
|------|------------------|
| 有効期限 | devise-security の **password_expirable** により、パスワードの有効期限を **3か月（90日）** としています（`config.expire_password_after = 90.days`）。 |
| 期限切れ時 | 期限経過後はログイン時にパスワード変更画面へ誘導し、変更するまで本システムを利用できません。 |

**回答**: パスワードの有効期限は **3か月（90日）以内**としており、期限経過後はパスワード変更を行うまで利用不可としています。

---

## 6. ユーザーごとに異なるパスワードを設定する

| 項目 | 本システムの対応 |
|------|------------------|
| 設計 | 各ユーザー（User）がそれぞれ自身のパスワードを保持する設計です。他ユーザーとパスワードを共有する仕組みはありません。 |

**回答**: **ユーザーごとに異なるパスワード**を設定する設計であり、ユーザーごとに固有のパスワードが設定されます。

---

## 7. 「aaa」「1234」等単純な文字列及び「password」等推測されやすい単語の使用は不可とする

| 項目 | 本システムの対応 |
|------|------------------|
| 英数字混在 | 要件1のとおり、数字・英小文字・英大文字を各1文字以上含むことを必須としています。 |
| ブラックリスト | 「aaa」「1234」「password」「qwerty」「admin」等の **単純な文字列および推測されやすい単語**をブラックリスト（`PasswordValidations::COMMON_PASSWORDS`）で登録し、これらと一致するパスワードは設定できないようにしています。 |

**回答**: **単純な文字列**（「aaa」「1234」等）および **推測されやすい単語**（「password」等）の使用は不可としており、英数字混在に加えブラックリストにより拒否しています。

---

## 8. ユーザー自身が、初回アクセス時にパスワードを設定する

| 項目 | 本システムの対応 |
|------|------------------|
| 初回設定 | 新規登録（サインアップ）時に、**ユーザー自身**がメールアドレスとあわせてパスワードを入力して設定します。 |
| フロー | 管理者が初期パスワードを発行する方式はとっておらず、本人が初回アクセス時（新規登録時）にパスワードを設定します。 |

**回答**: **ユーザー自身が、初回アクセス時**（新規登録時）**にパスワードを設定**する運用としており、本人のみがパスワードを知る形にしています。

---

## 9. パスワードの有効期限接近時には、変更を促す

| 項目 | 本システムの対応 |
|------|------------------|
| 期限切れ時 | 有効期限経過後は、ログイン時にパスワード変更画面へ誘導します（devise-security の password_expirable）。 |
| 接近時 | 有効期限の **約2週間前**から、ログイン後の画面で「パスワードの有効期限が近づいています（あと○日）」とフラッシュ表示し、**変更を促す**実装をしています。 |

**回答**: パスワードの有効期限 **経過後**はパスワード変更画面へ誘導します。あわせて、有効期限の **約2週間前**からログイン後画面で変更を促す表示を行っています。

---

## まとめ（9要件と実装の対応）

| No. | 要件 | 本システムの対応状況 |
|-----|------|---------------------|
| 1 | 8桁以上且つ英数字混在 | ✅ 8文字以上 + 英数字混在（数字・小文字・大文字各1文字以上）で検証 |
| 2 | ユーザーIDと同一のパスワードは許可しない | ✅ メールアドレスと同一のパスワードをバリデーションで拒否 |
| 3 | 連続失敗時にアカウント使用不可又は一定時間ログイン不可 | ✅ 5回連続失敗で1時間ログイン不可（Lockable） |
| 4 | パスワード入力時にマスク表示 | ✅ 全パスワード入力欄で password 型によりマスク表示 |
| 5 | 有効期限を3か月以内とする | ✅ 90日（3か月）で有効期限（password_expirable） |
| 6 | ユーザーごとに異なるパスワードを設定する | ✅ ユーザーごとに固有のパスワードを保持する設計 |
| 7 | 単純な文字列・推測されやすい単語の使用は不可 | ✅ 英数字混在 + ブラックリストで拒否 |
| 8 | ユーザー自身が初回アクセス時にパスワードを設定する | ✅ 新規登録時に本人がパスワードを設定 |
| 9 | 有効期限接近時に変更を促す | ✅ 約2週間前からフラッシュで変更を促す表示 |

上記のとおり、本システムはパスワード・認証に関する9要件を満たす実装となっています。
