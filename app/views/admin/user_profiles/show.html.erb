<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="h2 fw-bold mb-2"><%= @user_profile.name %></h1>
    <p class="text-muted mb-0">
      <i class="bi bi-envelope me-1"></i><%= @user_profile.user.email %>
      <% if @user_profile.manufacturer_user? %>
        <span class="ms-3">
          <i class="bi bi-truck me-1"></i>メーカー: <%= @user_profile.manufacturer.name %>
        </span>
      <% elsif @user_profile.company %>
        <span class="ms-3">
          <i class="bi bi-building me-1"></i><%= @user_profile.company.name %>
        </span>
      <% end %>
    </p>
  </div>
  <div class="d-flex gap-2">
    <%= link_to edit_admin_user_profile_path(@user_profile), class: "btn btn-outline-secondary btn-sm" do %>
      <i class="bi bi-pencil me-1"></i><%= t('user_profiles.show.edit') %>
    <% end %>
    <%= link_to admin_user_profiles_path, class: "btn btn-outline-primary btn-sm" do %>
      <i class="bi bi-arrow-left me-1"></i><%= t('user_profiles.show.back') %>
    <% end %>
  </div>
</div>

<div class="row g-4">
  <div class="col-lg-8">
    <div class="card shadow-sm border-0 mb-4">
      <div class="card-header bg-white border-bottom">
        <h5 class="card-title mb-1 fw-bold">
          <i class="bi bi-info-circle me-2"></i><%= t('user_profiles.show.profile_info') %>
        </h5>
        <small class="text-muted"><%= t('user_profiles.show.profile_info_desc') %></small>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label fw-semibold text-muted small mb-1"><%= t('user_profiles.form.name') %></label>
            <p class="mb-0 fw-medium"><%= @user_profile.name %></p>
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold text-muted small mb-1"><%= t('user_profiles.table.email') %></label>
            <p class="mb-0">
              <i class="bi bi-envelope me-1"></i><%= @user_profile.user.email %>
            </p>
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold text-muted small mb-1"><%= t('user_profiles.form.phone') %></label>
            <p class="mb-0"><%= @user_profile.phone || "-" %></p>
          </div>
          <% if @user_profile.payment_terms.present? %>
            <div class="col-md-6">
              <label class="form-label fw-semibold text-muted small mb-1"><%= t('user_profiles.form.payment_terms') %></label>
              <p class="mb-0"><%= @user_profile.payment_terms %></p>
            </div>
          <% end %>
          <div class="col-md-6">
            <label class="form-label fw-semibold text-muted small mb-1"><%= t('user_profiles.show.status') %></label>
            <p class="mb-0">
              <% case @user_profile.member_status %>
              <% when "active" %>
                <span class="badge bg-success"><%= t('user_profiles.status.active') %></span>
              <% when "pending" %>
                <span class="badge bg-warning"><%= t('user_profiles.status.pending') %></span>
              <% when "rejected" %>
                <span class="badge bg-danger"><%= t('user_profiles.status.rejected') %></span>
              <% when "unassigned" %>
                <span class="badge bg-secondary"><%= t('user_profiles.status.unassigned') %></span>
              <% end %>
            </p>
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold text-muted small mb-1"><%= t('user_profiles.form.role') %></label>
            <p class="mb-0">
              <% if @user_profile.manufacturer_user? %>
                <span class="badge bg-info">メーカー</span>
              <% else %>
                <% case @user_profile.role %>
                <% when "internal_admin" %>
                  <span class="badge bg-danger"><%= t('user_profiles.roles.internal_admin') %></span>
                <% when "company_admin" %>
                  <span class="badge bg-primary"><%= t('user_profiles.roles.company_admin') %></span>
                <% when "approver" %>
                  <span class="badge bg-success"><%= t('user_profiles.roles.approver') %></span>
                <% when "normal" %>
                  <span class="badge bg-secondary"><%= t('user_profiles.roles.normal') %></span>
                <% end %>
              <% end %>
            </p>
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold text-muted small mb-1"><%= t('user_profiles.show.supervisor') %></label>
            <p class="mb-0">
              <% if @user_profile.supervisor %>
                <i class="bi bi-person-badge me-1"></i><%= @user_profile.supervisor.name %>
                <small class="text-muted">(<%= @user_profile.supervisor.user.email %>)</small>
              <% else %>
                <span class="text-muted"><%= t('user_profiles.show.no_supervisor') %></span>
                <small class="text-muted d-block"><%= t('user_profiles.show.no_supervisor_desc') %></small>
              <% end %>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <% if @user_profile.manufacturer_user? && @user_profile.manufacturer %>
      <div class="card shadow-sm border-0 mb-4">
        <div class="card-header bg-white border-bottom">
          <h5 class="card-title mb-1 fw-bold">
            <i class="bi bi-truck me-2"></i>メーカー
          </h5>
          <small class="text-muted">発送依頼用ログインで表示されるメーカーです</small>
        </div>
        <div class="card-body">
          <p class="mb-1 fw-medium"><%= @user_profile.manufacturer.display_name %></p>
          <p class="mb-0 small text-muted"><%= @user_profile.manufacturer.respond_to?(:company) && @user_profile.manufacturer.company.present? ? @user_profile.manufacturer.company.name : "プラットフォーム共通" %></p>
        </div>
      </div>
    <% elsif @user_profile.company %>
      <div class="card shadow-sm border-0 mb-4">
        <div class="card-header bg-white border-bottom">
          <h5 class="card-title mb-1 fw-bold">
            <i class="bi bi-building me-2"></i><%= t('user_profiles.show.company_info') %>
          </h5>
          <small class="text-muted"><%= t('user_profiles.show.company_info_desc') %></small>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <label class="form-label fw-semibold text-muted small mb-1"><%= t('user_profiles.show.company_name') %></label>
            <p class="mb-0 fw-medium">
              <i class="bi bi-building me-1"></i><%= @user_profile.company.name %>
            </p>
          </div>
          <div class="mb-0">
            <label class="form-label fw-semibold text-muted small mb-1"><%= t('user_profiles.show.company_code') %></label>
            <p class="mb-0 font-monospace"><%= @user_profile.company.code %></p>
          </div>
        </div>
      </div>
    <% end %>

    <% if current_user.id != @user_profile.user_id && current_user.user_profile.can_approve_members? %>
      <div class="card shadow-sm border-0">
        <div class="card-header bg-white border-bottom">
          <h5 class="card-title mb-1 fw-bold">
            <i class="bi bi-gear me-2"></i><%= t('user_profiles.show.change_role') %>
          </h5>
          <small class="text-muted"><%= t('user_profiles.show.change_role_desc') %></small>
        </div>
        <div class="card-body">
          <div class="d-flex flex-column gap-2">
            <% UserProfile.roles.keys.each do |role| %>
              <% next if role == "internal_admin" && !current_user.internal_admin? %>
              <%= button_to change_role_admin_user_profile_path(@user_profile, role: role),
                  method: :post,
                  disabled: @user_profile.role == role,
                  class: "btn btn-sm w-100 #{@user_profile.role == role ? 'btn-secondary' : 'btn-primary'}" do %>
                <%= t("user_profiles.roles.#{role}") %>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
