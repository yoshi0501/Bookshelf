<%= form_with model: [:admin, company], class: "needs-validation", novalidate: true do |f| %>
  <%= render "shared/form_errors", resource: company %>

  <div class="card shadow-sm border-0 mb-4">
    <div class="card-header bg-white border-bottom">
      <h5 class="card-title mb-1 fw-bold">
        <i class="bi bi-building me-2"></i><%= t('companies.form.basic_info') %>
      </h5>
      <small class="text-muted"><%= t('companies.form.basic_info_desc') %></small>
    </div>
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-6">
          <%= f.label :code, t('companies.form.code'), class: "form-label fw-semibold" %>
          <%= f.text_field :code, class: "form-control font-monospace", required: true %>
        </div>

        <div class="col-md-6">
          <%= f.label :name, t('companies.form.name'), class: "form-label fw-semibold" %>
          <%= f.text_field :name, class: "form-control", required: true %>
        </div>
      </div>
    </div>
  </div>

  <div class="card shadow-sm border-0 mb-4">
    <div class="card-header bg-white border-bottom">
      <h5 class="card-title mb-1 fw-bold">
        <i class="bi bi-gear me-2"></i><%= t('companies.form.settings') %>
      </h5>
      <small class="text-muted"><%= t('companies.form.settings_desc') %></small>
    </div>
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-6">
          <%= f.label :order_prefix, t('companies.form.order_prefix'), class: "form-label fw-semibold" %>
          <%= f.text_field :order_prefix, placeholder: "ä¾‹: ORD", class: "form-control font-monospace text-uppercase", maxlength: 10 %>
          <div class="form-text"><%= t('companies.form.order_prefix_help') %></div>
        </div>

        <div class="col-12">
          <%= label_tag "company_domains", t('companies.form.domains'), class: "form-label fw-semibold" %>
          <%= text_area_tag "company[domains][]", company.domains.is_a?(Array) ? company.domains.join("\n") : "", rows: 4, class: "form-control font-monospace", placeholder: "example.com\nsubdomain.example.com", id: "company_domains" %>
          <div class="form-text"><%= t('companies.form.domains_help') %></div>
        </div>
      </div>
    </div>
  </div>

  <div class="card shadow-sm border-0 mb-4">
    <div class="card-header bg-white border-bottom">
      <h5 class="card-title mb-1 fw-bold">
        <i class="bi bi-toggle-on me-2"></i><%= t('companies.form.status') %>
      </h5>
      <small class="text-muted"><%= t('companies.form.status_desc') %></small>
    </div>
    <div class="card-body">
      <div class="form-check form-switch">
        <%= f.check_box :is_active, class: "form-check-input", role: "switch", id: "company_is_active" %>
        <%= f.label :is_active, t('companies.form.is_active'), class: "form-check-label fw-semibold", for: "company_is_active" %>
      </div>
    </div>
  </div>

  <div class="d-flex justify-content-end gap-2 mb-4">
    <%= link_to t('shared.actions.cancel'), admin_companies_path, class: "btn btn-outline-secondary" %>
    <%= f.submit t('shared.actions.save'), class: "btn btn-primary btn-lg" %>
  </div>
<% end %>

<script>
(function() {
  function initOrderPrefixUppercase() {
    const orderPrefixField = document.getElementById('company_order_prefix');
    if (orderPrefixField) {
      orderPrefixField.addEventListener('input', function(e) {
        e.target.value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
      });
    }
  }

  function initAll() {
    initOrderPrefixUppercase();
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initAll);
  } else {
    initAll();
  }

  document.addEventListener('turbo:load', initAll);
  document.addEventListener('turbo:frame-load', initAll);
})();
</script>
